<script lang="ts">
  import Layout from '../../layouts/Layout.svelte';
  import { cookieConsentStore } from '../../stores/cookie-consent.store';
  import Button from '../../components/ui/Button.svelte';

  // Recevoir les donn√©es du SSR
  let { user: ssrUser = null }: { user?: any } = $props();

  function openCookiePreferences() {
    cookieConsentStore.setPreferencesVisibility(true);
  }

  // Date de derni√®re mise √† jour (automatique)
  const lastUpdated = new Date().toLocaleDateString('fr-FR', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
</script>

<Layout title="Politique de Confidentialit√©" currentPage="/privacy-policy" user={ssrUser}>
<div class="privacy-policy">
  <div class="privacy-policy__header">
    <h1 class="privacy-policy__title">Politique de Confidentialit√© et Cookies</h1>
    <p class="privacy-policy__updated">Derni√®re mise √† jour : {lastUpdated}</p>
  </div>

  <div class="privacy-policy__content">
    <!-- Introduction -->
    <section class="privacy-section">
      <h2>1. Introduction</h2>
      <p>
        Bienvenue sur <strong>RecetteRanger</strong>. Nous accordons une grande importance √† la protection
        de votre vie priv√©e et √† la s√©curit√© de vos donn√©es personnelles. Cette politique de confidentialit√©
        vous informe sur la mani√®re dont nous collectons, utilisons, partageons et prot√©gons vos informations
        personnelles conform√©ment au <strong>R√®glement G√©n√©ral sur la Protection des Donn√©es (RGPD)</strong>.
      </p>
    </section>

    <!-- Responsable du traitement -->
    <section class="privacy-section">
      <h2>2. Responsable du Traitement des Donn√©es</h2>
      <p>
        Le responsable du traitement des donn√©es personnelles collect√©es sur RecetteRanger est :
      </p>
      <div class="privacy-info-box">
        <p><strong>RecetteRanger</strong></p>
        <p>Email de contact : contact@recetteranger.fr</p>
        <p>Vous pouvez nous contacter pour toute question relative √† vos donn√©es personnelles.</p>
      </div>
    </section>

    <!-- Donn√©es collect√©es -->
    <section class="privacy-section">
      <h2>3. Donn√©es Personnelles Collect√©es</h2>
      <p>Nous collectons diff√©rents types de donn√©es selon votre utilisation du service :</p>

      <h3>3.1 Donn√©es d'inscription</h3>
      <ul>
        <li>Pseudo</li>
        <li>Pr√©nom et nom</li>
        <li>Adresse email</li>
        <li>Mot de passe (chiffr√© et s√©curis√©)</li>
        <li>Photo de profil (optionnelle)</li>
      </ul>

      <h3>3.2 Donn√©es d'utilisation</h3>
      <ul>
        <li>Recettes cr√©√©es et enregistr√©es</li>
        <li>Listes de courses</li>
        <li>Planifications de repas</li>
        <li>Ingr√©dients et articles favoris</li>
        <li>Pr√©f√©rences utilisateur</li>
      </ul>

      <h3>3.3 Donn√©es techniques</h3>
      <ul>
        <li>Adresse IP</li>
        <li>Type de navigateur et version</li>
        <li>Syst√®me d'exploitation</li>
        <li>Pages visit√©es et dur√©e de visite</li>
        <li>Date et heure de connexion</li>
      </ul>
    </section>

    <!-- Finalit√©s du traitement -->
    <section class="privacy-section">
      <h2>4. Finalit√©s du Traitement</h2>
      <p>Vos donn√©es personnelles sont utilis√©es pour les finalit√©s suivantes :</p>

      <h3>4.1 Fourniture du service</h3>
      <ul>
        <li>Cr√©ation et gestion de votre compte utilisateur</li>
        <li>Acc√®s aux fonctionnalit√©s de l'application (recettes, listes de courses, plannings)</li>
        <li>Sauvegarde et synchronisation de vos donn√©es</li>
        <li>Communication relative au service (notifications, confirmations)</li>
      </ul>

      <h3>4.2 Am√©lioration du service</h3>
      <ul>
        <li>Analyse de l'utilisation pour am√©liorer l'exp√©rience utilisateur</li>
        <li>D√©tection et correction de bugs</li>
        <li>D√©veloppement de nouvelles fonctionnalit√©s</li>
      </ul>

      <h3>4.3 S√©curit√©</h3>
      <ul>
        <li>Protection contre les acc√®s non autoris√©s</li>
        <li>Pr√©vention de la fraude et des abus</li>
        <li>Respect de nos obligations l√©gales</li>
      </ul>
    </section>

    <!-- Base l√©gale -->
    <section class="privacy-section">
      <h2>5. Base L√©gale du Traitement</h2>
      <p>Le traitement de vos donn√©es personnelles repose sur :</p>
      <ul>
        <li><strong>Votre consentement :</strong> Pour les cookies non-n√©cessaires et les communications marketing</li>
        <li><strong>L'ex√©cution du contrat :</strong> Pour la fourniture du service que vous avez demand√©</li>
        <li><strong>L'int√©r√™t l√©gitime :</strong> Pour l'am√©lioration du service et la s√©curit√©</li>
        <li><strong>Les obligations l√©gales :</strong> Pour respecter nos obligations r√©glementaires</li>
      </ul>
    </section>

    <!-- Cookies -->
    <section class="privacy-section">
      <h2>6. Politique de Cookies</h2>
      <p>
        RecetteRanger utilise des cookies pour am√©liorer votre exp√©rience.
        Un cookie est un petit fichier texte stock√© sur votre appareil.
      </p>

      <h3>6.1 Types de cookies utilis√©s</h3>

      <div class="cookie-type">
        <h4>üîí Cookies N√©cessaires (Toujours activ√©s)</h4>
        <p>
          Ces cookies sont indispensables au fonctionnement du site. Ils ne peuvent pas √™tre d√©sactiv√©s.
        </p>
        <ul>
          <li><strong>auth_token</strong> : Authentification et maintien de session (7 jours)</li>
          <li><strong>session</strong> : Gestion de la session utilisateur</li>
          <li><strong>csrf_token</strong> : Protection contre les attaques CSRF</li>
        </ul>
      </div>

      <div class="cookie-type">
        <h4>‚öôÔ∏è Cookies Fonctionnels (Optionnels)</h4>
        <p>
          Ces cookies permettent de m√©moriser vos pr√©f√©rences et d'am√©liorer votre confort d'utilisation.
        </p>
        <ul>
          <li><strong>user_preferences</strong> : Pr√©f√©rences d'affichage et de navigation</li>
          <li><strong>language</strong> : Langue pr√©f√©r√©e</li>
          <li><strong>theme</strong> : Th√®me clair/sombre</li>
        </ul>
      </div>

      <div class="cookie-type">
        <h4>üìä Cookies Analytiques (Optionnels)</h4>
        <p>
          Ces cookies nous aident √† comprendre comment vous utilisez le site pour l'am√©liorer.
          Les donn√©es sont anonymis√©es.
        </p>
        <ul>
          <li><strong>_ga, _gid, _gat</strong> : Google Analytics (si activ√©)</li>
        </ul>
        <p class="cookie-note">
          <strong>Note :</strong> Actuellement, aucun service d'analytics n'est configur√©.
        </p>
      </div>

      <div class="cookie-type">
        <h4>üì¢ Cookies Marketing (Optionnels)</h4>
        <p>
          Ces cookies sont utilis√©s pour afficher des publicit√©s personnalis√©es.
        </p>
        <ul>
          <li><strong>_fbp</strong> : Facebook Pixel (si activ√©)</li>
          <li><strong>_gcl_au</strong> : Google AdSense (si activ√©)</li>
        </ul>
        <p class="cookie-note">
          <strong>Note :</strong> Actuellement, aucun service de marketing n'est configur√©.
        </p>
      </div>

      <h3>6.2 Gestion des cookies</h3>
      <p>
        Vous pouvez √† tout moment modifier vos pr√©f√©rences de cookies en cliquant sur le bouton ci-dessous
        ou via le lien "G√©rer les cookies" dans le footer du site.
      </p>
      <div class="privacy-action">
        <Button variant="primary" onclick={openCookiePreferences}>
          G√©rer mes pr√©f√©rences de cookies
        </Button>
      </div>

      <h3>6.3 Dur√©e de conservation des cookies</h3>
      <p>
        Votre consentement aux cookies est conserv√© pendant 12 mois. Pass√© ce d√©lai,
        nous vous demanderons √† nouveau votre consentement.
      </p>
    </section>

    <!-- Partage des donn√©es -->
    <section class="privacy-section">
      <h2>7. Partage des Donn√©es</h2>
      <p>
        Nous ne vendons jamais vos donn√©es personnelles. Vos donn√©es peuvent √™tre partag√©es uniquement dans
        les cas suivants :
      </p>
      <ul>
        <li>
          <strong>Prestataires de services :</strong> H√©bergement (serveurs s√©curis√©s), stockage d'images (Cloudinary)
        </li>
        <li>
          <strong>Obligations l√©gales :</strong> Sur demande des autorit√©s comp√©tentes dans le cadre l√©gal
        </li>
        <li>
          <strong>Protection de nos droits :</strong> Pour pr√©venir la fraude ou prot√©ger nos utilisateurs
        </li>
      </ul>
      <p>
        Tous nos prestataires sont conformes au RGPD et situ√©s dans l'Union Europ√©enne ou disposent
        de garanties appropri√©es.
      </p>
    </section>

    <!-- Vos droits RGPD -->
    <section class="privacy-section">
      <h2>8. Vos Droits RGPD</h2>
      <p>Conform√©ment au RGPD, vous disposez des droits suivants :</p>

      <div class="rights-grid">
        <div class="right-card">
          <h4>üëÅÔ∏è Droit d'acc√®s</h4>
          <p>Obtenir une copie de vos donn√©es personnelles</p>
        </div>

        <div class="right-card">
          <h4>‚úèÔ∏è Droit de rectification</h4>
          <p>Corriger ou mettre √† jour vos informations</p>
        </div>

        <div class="right-card">
          <h4>üóëÔ∏è Droit √† l'effacement</h4>
          <p>Demander la suppression de vos donn√©es ("droit √† l'oubli")</p>
        </div>

        <div class="right-card">
          <h4>üö´ Droit d'opposition</h4>
          <p>Vous opposer au traitement de vos donn√©es</p>
        </div>

        <div class="right-card">
          <h4>üì¶ Droit √† la portabilit√©</h4>
          <p>R√©cup√©rer vos donn√©es dans un format structur√©</p>
        </div>

        <div class="right-card">
          <h4>‚è∏Ô∏è Droit √† la limitation</h4>
          <p>Limiter le traitement de vos donn√©es</p>
        </div>

        <div class="right-card">
          <h4>‚Ü©Ô∏è Droit de retrait du consentement</h4>
          <p>Retirer votre consentement √† tout moment</p>
        </div>

        <div class="right-card">
          <h4>‚öñÔ∏è Droit de r√©clamation</h4>
          <p>D√©poser une plainte aupr√®s de la CNIL</p>
        </div>
      </div>

      <h3>8.1 Comment exercer vos droits ?</h3>
      <p>
        Pour exercer l'un de ces droits, vous pouvez :
      </p>
      <ul>
        <li>Nous contacter par email √† : <strong>privacy@recetteranger.fr</strong></li>
        <li>Acc√©der √† votre profil pour modifier vos informations personnelles</li>
        <li>Supprimer votre compte depuis les param√®tres de votre profil</li>
      </ul>
      <p>
        Nous nous engageons √† r√©pondre √† votre demande dans un d√©lai de <strong>1 mois maximum</strong>
        √† compter de la r√©ception de votre demande.
      </p>
    </section>

    <!-- S√©curit√© -->
    <section class="privacy-section">
      <h2>9. S√©curit√© des Donn√©es</h2>
      <p>Nous mettons en ≈ìuvre des mesures de s√©curit√© techniques et organisationnelles pour prot√©ger vos donn√©es :</p>
      <ul>
        <li>üîê <strong>Chiffrement :</strong> HTTPS pour toutes les communications, mots de passe chiffr√©s avec bcrypt</li>
        <li>üõ°Ô∏è <strong>Protection contre les attaques :</strong> CSRF, XSS, injection SQL</li>
        <li>üîí <strong>Cookies s√©curis√©s :</strong> HTTP-only, Secure, SameSite</li>
        <li>üîë <strong>Authentification :</strong> Tokens JWT s√©curis√©s avec expiration</li>
        <li>üìä <strong>Logs s√©curis√©s :</strong> Surveillance et d√©tection des activit√©s suspectes</li>
        <li>üîÑ <strong>Sauvegardes r√©guli√®res :</strong> Protection contre la perte de donn√©es</li>
      </ul>
    </section>

    <!-- Conservation des donn√©es -->
    <section class="privacy-section">
      <h2>10. Dur√©e de Conservation</h2>
      <p>Nous conservons vos donn√©es personnelles uniquement le temps n√©cessaire aux finalit√©s poursuivies :</p>
      <ul>
        <li><strong>Donn√©es de compte :</strong> Tant que votre compte est actif + 3 mois apr√®s suppression</li>
        <li><strong>Donn√©es de contenu :</strong> Tant que votre compte est actif</li>
        <li><strong>Logs de connexion :</strong> 12 mois maximum</li>
        <li><strong>Cookies :</strong> Dur√©e variable selon le type (voir section 6.3)</li>
      </ul>
    </section>

    <!-- Transferts internationaux -->
    <section class="privacy-section">
      <h2>11. Transferts Internationaux</h2>
      <p>
        Vos donn√©es sont principalement stock√©es et trait√©es au sein de l'Union Europ√©enne.
        Si des transferts vers des pays tiers sont n√©cessaires, nous nous assurons que des garanties
        appropri√©es sont en place (clauses contractuelles types de la Commission Europ√©enne).
      </p>
    </section>

    <!-- Mineurs -->
    <section class="privacy-section">
      <h2>12. Protection des Mineurs</h2>
      <p>
        RecetteRanger n'est pas destin√© aux personnes de moins de 16 ans.
        Si vous avez moins de 16 ans, vous ne devez pas utiliser ce service ni fournir de donn√©es personnelles.
        Si nous d√©couvrons qu'un mineur a cr√©√© un compte, nous le supprimerons imm√©diatement.
      </p>
    </section>

    <!-- Modifications -->
    <section class="privacy-section">
      <h2>13. Modifications de cette Politique</h2>
      <p>
        Nous pouvons modifier cette politique de confidentialit√© √† tout moment.
        En cas de modification substantielle, nous vous en informerons par email ou via une notification
        sur le site. La date de derni√®re mise √† jour est indiqu√©e en haut de cette page.
      </p>
    </section>

    <!-- Contact -->
    <section class="privacy-section">
      <h2>14. Nous Contacter</h2>
      <p>Pour toute question concernant cette politique de confidentialit√© ou vos donn√©es personnelles :</p>
      <div class="contact-box">
        <p><strong>Email :</strong> privacy@recetteranger.fr</p>
        <p><strong>Objet :</strong> "Donn√©es personnelles - RGPD"</p>
      </div>
      <p>
        Vous pouvez √©galement contacter la <strong>CNIL (Commission Nationale de l'Informatique et des Libert√©s)</strong>
        si vous estimez que vos droits ne sont pas respect√©s :
        <a href="https://www.cnil.fr" target="_blank" rel="noopener noreferrer">www.cnil.fr</a>
      </p>
    </section>
  </div>
</div>
</Layout>

<style lang="scss">
  @use '../../styles/variables' as *;

  .privacy-policy {
    max-width: 900px;
    margin: 0 auto;
    padding: $spacing-xl;
    margin-top: 40px; // Espace en desktop pour √©viter le chevauchement avec le logo

    @media (max-width: $breakpoint-md) {
      padding: $spacing-md;
      margin-top: 80px; // Espace pour √©viter le chevauchement avec le logo sur mobile
    }

    @media (max-width: $breakpoint-sm) {
      margin-top: 100px; // Plus d'espace sur tr√®s petit √©cran
    }

    &__header {
      text-align: center;
      margin-bottom: $spacing-xl;
      padding-bottom: $spacing-lg;
      border-bottom: 2px solid $brand-primary;
    }

    &__title {
      color: $brand-primary;
      font-size: $font-size-4xl;
      margin: 0 0 $spacing-sm 0;

      @media (max-width: $breakpoint-md) {
        font-size: $font-size-xl;
      }
    }

    &__updated {
      color: $color-gray-600;
      font-size: $font-size-sm;
      margin: 0;
    }

    &__content {
      line-height: 1.7;
    }
  }

  .privacy-section {
    margin-bottom: $spacing-xl;

    h2 {
      color: $brand-primary;
      font-size: $font-size-xl;
      margin: 0 0 $spacing-md 0;
      padding-top: $spacing-lg;
    }

    h3 {
      color: $color-gray-800;
      font-size: $font-size-lg;
      margin: $spacing-lg 0 $spacing-sm 0;
    }

    h4 {
      color: $color-gray-700;
      font-size: $font-size-base;
      margin: $spacing-md 0 $spacing-xs 0;
    }

    p {
      color: $color-gray-700;
      margin: 0 0 $spacing-md 0;
    }

    ul {
      color: $color-gray-700;
      margin: $spacing-sm 0 $spacing-md 0;
      padding-left: $spacing-xl;

      li {
        margin-bottom: $spacing-xs;
      }
    }

    strong {
      color: $color-gray-800;
      font-weight: $font-weight-semibold;
    }

    a {
      color: $brand-primary;
      text-decoration: underline;

      &:hover {
        color: $brand-quaternary;
      }
    }
  }

  .privacy-info-box,
  .contact-box {
    background: $color-gray-50;
    border-left: 4px solid $brand-primary;
    padding: $spacing-md;
    margin: $spacing-md 0;
    border-radius: $radius-sm;

    p {
      margin: $spacing-xs 0;
    }
  }

  .privacy-action {
    margin: $spacing-md 0;
  }

  .cookie-type {
    background: $color-gray-50;
    border-radius: $radius-md;
    padding: $spacing-md;
    margin: $spacing-md 0;

    h4 {
      margin-top: 0;
      color: $brand-primary;
    }

    p {
      margin: $spacing-xs 0 $spacing-sm 0;
    }

    ul {
      margin: $spacing-sm 0;
    }
  }

  .cookie-note {
    background: $color-warning-light;
    border-left: 3px solid $color-warning;
    padding: $spacing-xs $spacing-sm;
    margin-top: $spacing-sm;
    font-size: $font-size-sm;
    border-radius: $radius-sm;

    strong {
      color: $color-warning-dark;
    }
  }

  .rights-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: $spacing-md;
    margin: $spacing-lg 0;
  }

  .right-card {
    background: $color-white;
    border: 2px solid $color-gray-200;
    border-radius: $radius-md;
    padding: $spacing-md;
    transition: all 0.2s ease;

    &:hover {
      border-color: $brand-primary;
      box-shadow: 0 4px 12px $color-black-alpha-10;
      transform: translateY(-2px);
    }

    h4 {
      margin: 0 0 $spacing-xs 0;
      color: $brand-primary;
      font-size: $font-size-base;
    }

    p {
      margin: 0;
      font-size: $font-size-sm;
      color: $color-gray-600;
    }
  }
</style>
